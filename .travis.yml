language: java
jdk: openjdk8
services:
- docker
branches:
  except:
  - "/^[0-9]/"
before_script:
- git config --global user.name "${GIT_USER_NAME}"
- git config --global user.email "${GIT_USER_EMAIL}"
- cp .travis.settings.xml $HOME/.m2/settings.xml
stages:
- name: devbuild
  if: branch != master
- name: masterdeploy
  if: branch = master

jobs:
  include:
  - stage: devbuild
    name: Development Build
    script: mvn clean install jib:dockerBuild -Drevision=${TRAVIS_BUILD_NUMBER}.$(git
      rev-parse --short HEAD)
  - stage: masterdeploy
    name: build master, site and deploy
    script: 
     - export ARTID=$(mvn -q -Dexec.executable=echo -Dexec.args='npiper/${project.artifactId}
     - export REV=${TRAVIS_BUILD_NUMBER}.$(git rev-parse --short HEAD)
     - mvn install jib:dockerBuild scm:tag deploy site -Drevision=${TRAVIS_BUILD_NUMBER}.$(git rev-parse --short HEAD) -Dusername="${GIT_USER_NAME}" -Dpassword="${GITPW}"
     - echo "${DOCKER_PASSWORD}" | docker login -u "${DOCKER_USERNAME}" --password-stdin && docker images && docker push npiper/archdiagrams:${TRAVIS_BUILD_NUMBER}.$(git rev-parse --short HEAD)


env:
  global:
  - secure: Ne0GCbBuip31i1pN0TbdWCXrDfP2RPFKZiaAO+azBjD2VAT3MYBCBx+7+6tvtqLY/7OM99sdjR5C7cn68aGA4hEuDiyYiEF8OrS2I/npjEtqivMwN9cBNbXMzBtIESkxuyNL5lqCxN+UNeZgTS2yybUcVUrKvqDLpvYjK5//7cRTPMuFM3gyN+vvI7Luzzujy00v7X3e7kxo3cP9Fyw8EgfnsMwJUmVp0Yg7x3jX73Y96j4ibDD/5oLV6CPpf9BLPLa/NN//Ne7Q0Nwx7wZRMlDyVv0i47Gh+cz2qzZtHUMJF/Mmxg6QS0Q5qMIm7gsPG7FPi96RqHVcxJntgxGG55niZVw358usTVOUI7CcqiJkDR3c5/jvbnJlm5JNwgUS57lyhmHHMfPQ7f4NRY3jlw2BWbwAAxX3O4p3YfexWATja+NHQuZ2jiklLJawJ268G8Wxk53Q/csQUklPKPC9QyC3wF5yTLwCBdo8GuUMyHN1Bw9AiJODDW3O55e10OM75b8WGcXXkM4LtOiPSRYxe4zjtaav3xx4vuFRqWDr29Yahlpu+WNfJrBNGn5qaU6J3yfjbXoQBDg1ondxTh47n5M5btLT6Phk6sH0HUhXioxwrF9ss3TRp9xEfJUl8eKjnvDMzYcS92Sb2GQymIOw8cy42lG4izYu0yFdHNHU13M=
  - secure: KOIYdYf0sRwJatXpZtei6M8DStTXp7z4S9/9z+aRjXricG2OQfyuJBa6EshqDU4cI2gvle4dpRxVffTTujie0UVKaZn0CsXJSYvV9MQVJsjMC42Mnh4u/fNIDg7dS57HKL9oeSozv28iY7DwZfB766gGlWAI0YByXRcu2jBCSnRQzEuNm6nkut9LsONOVMS4CweYnQfivDjvogj9KbsYM91+ahOIGv0JokteRYlmMYqeCazL/eglMo8GV9owUeMPNLu9tGeK/6FDMU1MXM9mR8Ut3tfspZzMcM8sRJVnt8sZARoidAIRi8tYm4PQ1Fd1xtaXD+cp9Xaazw08TC7uBMCCm4cnbKOlUTrrLvGXbVMO+SMhuvztpUHOLTfsf/yXitWx1rDfzegOmRJSnv/pCV6Iifyk/vBSJTBGJvUDRfRpMZm9TdEIXU9ykwKvl/gWsWvSLvCQrkFfHz4T8tQpA/y/2OxivwqmLGpU4Xy15ClGor+BhfRp5cxafUMsscQ8HQv9oqB+uaLtOEsNexpOkfUdzKB0RdfEm/pf0Vg63uzBFz/8iEabXve2xiA3/JvSnRsO7MYGw9da0YYbKdojrq6eHuh0Hxjee0AXrdbAtXIpfymCPLGVY3qrkWhiRy/R++F+Rgcp2KpNIQBQmWBJo8TFLw9ZTZfHbq8IQjn8tI8=
  - secure: Lh5H6XuidAjQ37IHaXJvKALhav5MlClp5jrJ39Br1yp8+8F/XdkITp4VHs5IueifyDB2fXdHJnuiZFRzhD/5fIKXzo8W0aLLgdp5/ePRgwywYINk2DEvtUc/AHIJvdFBGM7u5o8wkieyLMii7/tQ3eO5l1yyJ2cS78fIEqM80JRwf0icDkmF3SI508Kp2edqVsKxxCYDdKuKcSM/ftpijENS2pzBQ3/yqVv3xx3d9YL+b7yoIZItnW5AlnNcQhYODvqF3e4Z90H27CdYfYn5FbjIYA7J05MYqR8+e2fSgkB2yQuTXNrOD6mkGOJsEiUoGx5lO3m02HiRIFsxitPGaWCVElud7kAmIluB4Mn5OG386kFZdFUAUXPD2yzGEf4OeW53lVR257JngNd2O5wvxQT5JFk8ZjPWrW5E1Dw8VjkHYgy0DMi7P1jMATAhF5vGM7i/B4IRxTI3npUOJK4kwzDiXUDfzXNGFHjb20I2xkujkLsDj1M+AMDVicyrS/gaD7BKIuP1iZcvkAzGrDMXuidGUBu9szwvxJl5zBL2yPseUza9XbdArz0DE9Ei+8p0Xtflq/Zk4XwHgXXEov0ANM2CIrC2XZGxWLXDnMMhfCfBLhvejXaLx4FEO49ow4C4Ri9RxWvDbsgCH+vLbsRRN7phVOhqZQxHmPxj2dAJ+d8=
  - secure: DXSvKIpHMJKT9BaxrJVYtZofhMOES5Jknj5YQ9RO189UdWm9cSaB1kjOK+C8du8bqNvs+73TPqIknLM4gCw/fp7xgX+Rqrx1LCfUrwcQ4W9WB07a+LtpD7+qe0oXMMxhIFkdRSbS5qUsJ5XurnVsdt1q4nC77bJYQJkOFZW70Z0VyyuWIAUVSX/gv7A0/HZiFFc8JEjMq7t+Ds1bKNl1dxfJITl+aTDpayX/ZoLQ+R3qMVR9A15segxcd/0L0bkQbACxzqzA1IObSvY99i6U+unS80ydECB8QPXibeIR2ILefX0qUGNN68UYRQdrwUHe3GXMjoCPm1WheGIw350KG4YIoO8B6uXWgFwgdvY5bbVWzv5+eVySjLzrbL2ercVi702bYTyZkg0eZ5/RkSJH+9ytARc11BQLRwqPlzr44TbW+5NEwaHQBVhbNDBbD4Sk8to36yIu7tE8l0td4xDwAqh8Kc4auK584xIRmeNWffXXx6KkOqrmRs5MgZg+KjNSRkOYVmmbxDdD2OaqG5QjuTPu9SY6IqWqG/1F2zFQmPkQeg3dEdDQHlOMRAjWB0GcYB69KZNOAbCaOArHhQBMTtAFoaofRr8EG99MqrOVVxKiHuuFByZB37hD9rFN2Tp9A/G67R/NY/6NgUWgMa5laQK6feAPXAyiHao80mLjH5A=
  - secure: aNJ0EIWrdWt38wbSOUu219LJ7Udo3pE5AE0aVPeRDe7RJkxJcqzXAnL77FN9uebRJCZCxSAqtlGvy3l4rXjpO0xtbjJPXtT4Zw3zOG8KqKFeEzo/+lV3R+CqwSySzrDz7pe2HHQfPsigotz55KzIhx2bgcl67RrtWz5jJZUvjG7rMrq5hBESQZIT2xKjFhHnlPn8K378b4j4lu7zuDvdE/3MixBEw3StGLDVfewMnc18f1FNakLZQK75hz7WQK6rrqz6xD80CU5wSXCrtKf284OeJVACnZHNR4YuVTnGmqeNyJJ5Js44NBYW76XHJf+Y5pTRNA+mwbFx+YQN1v7DyEOm/63CpdYlf7hKcu5BhAeNhetyZODoADzpLg9ewfi4YlyQW9D2w7Sk1kczdnb1Tq5M5g2ZZ5Irf76/NIPk5aJG7BjqQ3co3pMN9fVWDa/kLutSY8/HlKTb2IIVghTrn4zzjqrBVwEosekBtMaysmVXLlxRSU6M7oEYhZzpaQgNNeI4/FQtyqMDikaqRbnyPQRWSIsFlOvQga/zoojPELF+kyRh0lj/yMuEmS1bQsDrYkVdwdXaTtxCsflhevbJD7BRaU3z3upzrJiYekqYEyPuHRXRGGlGNdHNQqmsYjvPjjguQ8XKwqGvbTnMJ9mHue81pI+bh513CNsfYNpCgPs=
  - secure: datQy66lRu6p9EUv0rI9sHgCyx+JFSkMWEMY2HDXYBDBxDpk0MWXH4WxwsfkTXE0LnY9mgT6w9mPmYNIj5mYYjKYHwryXJhcAENB7vm6gfTajU9SEvE+i6jni19RhNQW+HTa+zmeGTGhnVLgkkBSGrC6HFtK7fYoe6NK4YVdsIqSUOFEQ5SDMzGi0yqE3JIRHlxpi9eZYf1yfrLxTrQTsq43PEnWC1+kizKuC1+zrADVugTJA5tTDG8pu8HRSgwMZrBojHJAaHSm59+xgtBI2zfDGPQLhc1bE264Ov/78vAY/R0w7dEn+Qz0GRtcAEjIVVdm35wKoN9dYW9C7KWdlrq3OPq3zd3fxm9quftZKLCNKuR8eSQdmplAmtRYCT1F9UVXf47kUnHk6nUhdAbTNl/CtasNGoEnwYN8MouxAd4scz4Sb9KhcZa2Bq6uqSRfXVDtb3s/SJ8/BG8n4oVaiGlejj3kH5D3BNp8o6y6cH3LTgU7DSza5P5tOgQ/O94LwY9YXri4XhQ5SgDL0eji1vnL46Vp12eAsjneWwlHQx9udFWtoswKIVMPVrTmFr0AwznZAvhPlcwR9K196GsOek4DB64aitNBBLs0g9l7bq8rXJaF96Ji03DTWJ8V/Ynw6lDHxDMEL66Z8yNPK+mpqeHABnGfSi4ENvRo/MYTIJ8=
